import{d as V,H as m,L as O,o as T,a as B,x as d,m as e,w as l,f as a,p as _,A as C,a5 as I,aB as i}from"./index-Py-scUnY.js";import"./el-tag-W3Up5px_.js";import{E as k,a as S}from"./el-table-column-8BfuS7ep.js";import"./el-scrollbar-fUPsGVw2.js";/* empty css                */import{E as N}from"./el-button-XlAlre1l.js";import{E as j,a as F}from"./el-form-item-TCtL6sAE.js";import{E as P}from"./el-input-_WaFOvKQ.js";import{E as U}from"./el-message-box-vOSiWxcX.js";import"./el-overlay-xG09RX4O.js";import{E as $}from"./index-HUOZQA-l.js";import"./_Uint8Array-NC-A-qIZ.js";import"./_initCloneObject-wcG7vwCV.js";import"./debounce-B7PqWfie.js";import"./use-form-item-REpgKkM3.js";import"./castArray-NImCjEXY.js";import"./scroll-AUypToXu.js";const q=d("h3",{style:{"text-align":"center"}},"點餐紀錄查詢",-1),D=d("p",{style:{"text-align":"center",color:"red"}},"僅能查詢30天內訂單",-1),H={style:{display:"flex","justify-content":"center"}},J={style:{width:"100%","max-width":"768px"}},M={style:{"text-align":"center"}},z={style:{margin:"1rem 0 0 2rem"}},A=d("h3",null,"品項",-1),pe=V({__name:"orderHistory",setup(L){const u=m(null),n=m({orderId:null,name:null,telephone:null}),c=m(!1),g=m([]),h=p=>{p&&p.validate(o=>{o&&(c.value=!0,fetch("/api/orderStatus",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n.value)}).then(s=>s.json()).then(s=>{s.code===200?(g.value=s.data,i.success("查詢成功!")):i.error("查無此訂單!")}).catch(()=>{i.error("查詢失敗!")}).finally(()=>{c.value=!1}))})},E=p=>{U.confirm("此操作將取消訂單, 是否繼續?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then(()=>{fetch("/api/cancelOrder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:p})}).then(o=>o.json()).then(o=>{o.code===200?(i.success("取消成功!"),h(u.value)):i.error("取消失敗!")}).catch(()=>{i.error("取消失敗!")})}).catch(()=>{})},w=O({name:[{required:!0,message:"請輸入訂餐姓名",trigger:"blur"}],telephone:[{required:!0,message:"請輸入電話號碼",trigger:"blur"},{pattern:/^09\d{8}$/,message:"請輸入正確的電話號碼",trigger:"blur"}]});return(p,o)=>{const s=P,f=j,b=N,x=F,r=k,y=S,v=$;return T(),B(I,null,[q,D,d("div",H,[d("div",J,[e(x,{model:a(n),ref_key:"findOrderFormRef",ref:u,rules:a(w)},{default:l(()=>[e(f,{label:"訂單編號",prop:"orderId"},{default:l(()=>[e(s,{modelValue:a(n).orderId,"onUpdate:modelValue":o[0]||(o[0]=t=>a(n).orderId=t),autocomplete:"off",placeholder:"可不填"},null,8,["modelValue"])]),_:1}),e(f,{label:"訂餐姓名",prop:"name"},{default:l(()=>[e(s,{modelValue:a(n).name,"onUpdate:modelValue":o[1]||(o[1]=t=>a(n).name=t),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(f,{label:"電話號碼",prop:"telephone"},{default:l(()=>[e(s,{modelValue:a(n).telephone,"onUpdate:modelValue":o[2]||(o[2]=t=>a(n).telephone=t),autocomplete:"off"},null,8,["modelValue"])]),_:1}),d("div",M,[e(b,{type:"primary",onClick:o[3]||(o[3]=t=>h(a(u))),loading:a(c)},{default:l(()=>[_("查詢")]),_:1},8,["loading"])])]),_:1},8,["model","rules"]),e(y,{data:a(g)},{default:l(()=>[e(r,{type:"expand"},{default:l(t=>[d("div",z,[A,e(y,{data:t.row.item},{default:l(()=>[e(r,{label:"名稱",prop:"name"}),e(r,{label:"數量",prop:"count"})]),_:2},1032,["data"])])]),_:1}),e(r,{prop:"orderId",label:"訂單編號"}),e(r,{prop:"tableNumber",label:"桌號"}),e(r,{prop:"name",label:"姓名"}),e(r,{prop:"telephone",label:"電話號碼"}),e(r,{prop:"totalPrice",label:"總價格"}),e(r,{prop:"status",label:"訂單狀態"},{default:l(t=>[e(v,{effect:"dark",type:t.row.status===0?"info":t.row.status===1?"":t.row.status===2?"success":"danger"},{default:l(()=>[_(C(t.row.status===0?"等待中":t.row.status===1?"已接單":t.row.status===2?"已完成":"已取消"),1)]),_:2},1032,["type"])]),_:1}),e(r,{prop:"status",label:"操作",width:"100"},{default:l(t=>[e(b,{disabled:t.row.status!==0,type:"danger",size:"small",onClick:R=>E(t.row.orderId)},{default:l(()=>[_("取消訂單")]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data"])])])],64)}}});export{pe as default};
